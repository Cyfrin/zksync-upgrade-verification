// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Test, console, GetProposalHashTest} from "test/Base__GetProposalHash.t.sol";
import {GetProposalHash} from "src/GetProposalHash.sol";

contract ZIP4ProposalHashTest is GetProposalHashTest {
    function testZip4ProposalHash() public {
        // The target address of the proposal
        targets = [0x0000000000000000000000000000000000008008];

        // The value from the proposal
        values = [0];

        // The calldatas from the proposal, with the additional function selector and dynamic bytes size
        // cast calldata-decode cast calldata-decode "propose(address[],uint256[],bytes[],string)"' <CALLDATA>
        // The above will give you the calldata that will be passed to "sendToL1(bytes)"
        // Put that here
        calldatas.push(
            hex"62f84b24000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000005d8ba173dc6c3c90c8f7c04c9288bef5fdbad06e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024f34d18680000000000000000000000000000000000000000000000000000000000002a3000000000000000000000000000000000000000000000000000000000"
        );

        // See how to get the description from the calldata in the "how-to-get-description.md" file
        string memory description =
            unicode"# [ZIP-4] Reduce the execution delay from 21 hours to 3 hours\n| **Title**                | \\[ZIP-4] Reduce the execution delay on ZK Chains from 21 hours to 3 hours                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| **One Sentence Summary** | This ZIP proposes reducing the execution delay on ZK Chains from 21 hours to 3 hours.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n| **Proposal Author**      | Matter Labs, point of contact is Samuel Kaufman                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n| **Proposal Sponsor**     | Cyfrin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n| **Date Created**         | 09-January-2025                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n| **Version**              | 1.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n| **Summary of Action**    | *This proposal is a resubmission of [ZIP-2](https://www.tally.xyz/gov/zksync/proposal/26668700835266663714039744560208859829224989416465690918246196287077853242?govId=eip155:324:0x76705327e682F2d96943280D99464Ab61219e34f). For more information related to the recommendation to resubmit the proposal please see [this forum post](https://forum.zknation.io/t/update-on-zip-1-decision-to-resubmit-proposal-following-tooling-issue/368) by the ZKsync Security Council.* Decrease the execution delay to enhance user experience and operational efficiency, leveraging the recently established Security Council for rapid response in emergency situations. |\n\n## **Simple Summary**\n\n*This proposal is a resubmission of* [ZIP-2](https://www.tally.xyz/gov/zksync/proposal/26668700835266663714039744560208859829224989416465690918246196287077853242?govId=eip155:324:0x76705327e682F2d96943280D99464Ab61219e34f)*. For more information related to the recommendation to resubmit the proposal please see* [this forum post](https://forum.zknation.io/t/update-on-zip-1-decision-to-resubmit-proposal-following-tooling-issue/368) *by the ZKsync Security Council.*\n\nThis ZIP proposes to reduce the execution delay on ZK Chains from the current 21 hours to 3 hours, enhancing transaction finality while maintaining security through the oversight of the newly established Security Council.\n\n## **Abstract**\n\n*This proposal is a resubmission of* [ZIP-2](https://www.tally.xyz/gov/zksync/proposal/26668700835266663714039744560208859829224989416465690918246196287077853242?govId=eip155:324:0x76705327e682F2d96943280D99464Ab61219e34f)*. For more information related to the recommendation to resubmit the proposal please see* [this forum post](https://forum.zknation.io/t/update-on-zip-1-decision-to-resubmit-proposal-following-tooling-issue/368) *by the ZKsync Security Council.*\n\nThe proposal aims to shorten the execution delay in the ZKsync Era and ZK Chains network to improve user experience and operational efficiency. With the establishment of the Security Council, we can confidently reduce the delay to 3 hours, providing sufficient time for emergency interventions without compromising the network\'s security.\n\n## **Motivation**\n\n* **Enhancing User Experience** : A shorter execution delay means faster transaction confirmations, which improves the overall user experience.\n* **Operational Efficiency** : Reducing the delay streamlines operations for developers and businesses relying on ZKsync Era and ZK Chains\n* **Security Assurance** : The newly formed Security Council can promptly address any security issues within the reduced timeframe.\n\nHistorically, the 21-hour delay was a precautionary measure to allow time for manual intervention in case of critical issues. However, this long delay can hinder the network\'s usability and responsiveness. Now that the Security Council is in place with the authority to freeze the chain in emergencies, we can safely reduce the delay to 3 hours.\n\n## **Specification**\n\nThe technical changes involve updating the network\'s parameters to adjust the execution delay from 21 hours to 3 hours. Specifically:\n\n1. **Parameter Update** : Modify the delay parameter in the network\'s smart contracts and configuration files to reflect the new 3-hour delay.\n2. **Security Protocols** : Ensure that the Security Council\'s monitoring systems are fully operational to detect and respond to issues within the reduced timeframe.\n3. **Testing** : Perform extensive testing on testnets to validate the change and monitor for any unforeseen impacts.\n\nThese changes require coordinated updates across all nodes and stakeholders to ensure a smooth transition.\n\n```\n{\n        \"index\": 8,\n        \"network\": \"mainnet\",\n        \"from\": \"0x8f7a9912416e8AdC4D9c21FAe1415D3318A11897\",\n        \"to\": \"0x5D8ba173Dc6C3c90C8f7C04C9288BeF5FDbAd06E\",\n        \"functionName\": \"setExecutionDelay\",\n        \"functionSignature\": \"setExecutionDelay(uint32)\",\n        \"arguments\": {\n            \"_executionDelay\": {\n                \"type\": \"uint32\",\n                \"value\": \"10800\"\n            }\n        },\n        \"description\": \"Validator Timelock - Decrease Execution Delay\"\n    },\n```\n\n## **Rationale**\n\nReducing the execution delay enhances the network\'s efficiency without sacrificing security because:\n\n* **Security Council\'s Role** : The Security Council can act within the 3-hour window to freeze the chain if a critical issue arises.\n* **Adequate Response Time** : Three hours is sufficient for the Security Council to investigate issues and coordinate a response without rushing decisions.\n* **Improved Competitiveness** : A shorter delay aligns ZKsync Chains with industry standards, making it more attractive to users and developers.\n\nAlternative options, such as incremental reductions or maintaining the status quo, were considered. However, a direct reduction to 3 hours offers immediate benefits and is feasible given the current security infrastructure.\n\n## **Execution Impact**\n\n* **User Transactions** : Users will experience faster transaction finality, improving satisfaction and engagement.\n* **Developers and Businesses** : Quicker execution times enable more responsive applications and services.\n* **Network Performance** : Overall network throughput and efficiency are expected to improve.\n\nNo negative impacts are anticipated, but continuous monitoring will be in place to address any issues promptly.\n\n## **Backwards Compatibility**\n\nThis change is backward-compatible as it does not alter existing smart contract interfaces or require modifications from users or developers. All existing transactions and contracts will continue to function correctly under the new execution delay.\n\n## **Security Considerations**\n\n* **Emergency Response** : The Security Council has protocols to quickly freeze the chain within the 3-hour window if necessary.\n* **Monitoring Systems** : Enhanced monitoring will be implemented to detect anomalies in real-time.\n* **Risk Assessment** : A thorough risk assessment has been conducted, and no significant security risks have been identified with the reduced delay.\n\nThe Security Council\'s ability to act swiftly mitigates potential risks associated with the shorter delay.";

        descriptionHash = getProposalHash.hashDescription(description);
        uint256 proposalId = getProposalHash.hashProposal(targets, values, calldatas, descriptionHash);

        console.logBytes32(descriptionHash);
        console.log(proposalId);
        console.logBytes32(bytes32(proposalId));
    }
}
